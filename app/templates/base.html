<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Smart Water Monitoring{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block head %}{% endblock %}
</head>
<body>

<nav class="navbar navbar-light">
    <div class="container d-flex justify-content-between align-items-center">
        <a href="{{ url_for('main.login') }}" class="navbar-brand">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" height="38" class="me-2">
            Smart Water Monitoring
        </a>

        {% if current_user.is_authenticated %}
        <div class="d-flex align-items-center gap-3">
            <div class="fw-semibold" onclick="toggleUserInfo(event)" style="cursor:pointer; color: var(--deep-blue);">
                ðŸ‘¤ {{ current_user.username }}
            </div>
            <div id="userInfoPopup" class="glass-card position-absolute p-3" style="display:none; right:10%; top:70px; z-index:1000; min-width:220px;">
                <p class="mb-1 small"><strong>User:</strong> {{ current_user.username }}</p>
                <p class="mb-0 small"><strong>Visits:</strong> {{ current_user.visit_count }}</p>
            </div>
            <a href="{{ url_for('main.logout') }}" class="btn btn-sm btn-outline-danger rounded-pill px-3">Logout</a>
        </div>
        {% endif %}
    </div>
</nav>

<div class="container mt-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} rounded-4 border-0 shadow-sm mb-4">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
</div>

<script>
function toggleUserInfo(event) {
    event.stopPropagation();
    const popup = document.getElementById("userInfoPopup");
    popup.style.display = popup.style.display === "none" ? "block" : "none";
}
document.addEventListener("click", () => {
    document.getElementById("userInfoPopup").style.display = "none";
});
</script>
</body>
</html>
